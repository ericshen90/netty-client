# Netty-Client-Demo

[English Version](./README.md)

åŸºäº Netty æ¡†æ¶å¹¶é›†æˆ Spring Boot çš„å®¢æˆ·ç«¯å®ç°ï¼ŒåŒ…å« Google Protobuf åºåˆ—åŒ–ã€å¿ƒè·³æœºåˆ¶ã€è‡ªåŠ¨æ–­çº¿é‡è¿åŠèº«ä»½éªŒè¯ç­‰åŠŸèƒ½ã€‚

## ğŸ“‹ ç›®å½•
- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [è¯¦ç»†è®¾è®¡](#è¯¦ç»†è®¾è®¡)
  - [1. Netty å®¢æˆ·ç«¯é…ç½®](#1-netty-å®¢æˆ·ç«¯é…ç½®)
  - [2. Protobuf é€šä¿¡](#2-protobuf-é€šä¿¡)
  - [3. å¿ƒè·³æœºåˆ¶ä¸ç©ºé—²æ£€æµ‹](#3-å¿ƒè·³æœºåˆ¶ä¸ç©ºé—²æ£€æµ‹)
  - [4. é‡è¿ç­–ç•¥](#4-é‡è¿ç­–ç•¥)
  - [5. èº«ä»½éªŒè¯æ¡æ‰‹](#5-èº«ä»½éªŒè¯æ¡æ‰‹)
- [æµ‹è¯•è¯´æ˜](#æµ‹è¯•è¯´æ˜)
- [å‚è€ƒèµ„æ–™](#å‚è€ƒèµ„æ–™)

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§
- **Spring Boot é›†æˆ**: ä¾¿äºç®¡ç†å’Œéƒ¨ç½²ã€‚
- **Protobuf åºåˆ—åŒ–**: é«˜æ€§èƒ½ã€è·¨è¯­è¨€çš„äºŒè¿›åˆ¶åè®®ã€‚
- **å¿ƒè·³æœºåˆ¶**: ç¡®ä¿è¿æ¥çš„æ´»è·ƒçŠ¶æ€ã€‚
- **è‡ªåŠ¨é‡è¿**: åº”å¯¹ç½‘ç»œä¸ç¨³å®šæˆ–æœåŠ¡ç«¯é‡å¯ã€‚
- **èº«ä»½éªŒè¯**: åˆå§‹æ¡æ‰‹ä»¥ç¡®ä¿è¿æ¥å®‰å…¨ã€‚
- **é€šç”¨æ¶ˆæ¯å°è£…**: ä½¿ç”¨ `google.protobuf.Any` å®ç°çµæ´»çš„é€šä¿¡åè®®ã€‚

## ğŸ›  æŠ€æœ¯æ ˆ
- **Java**: 1.8
- **Spring Boot**: 2.0.6.RELEASE
- **Netty**: 4.1.38.Final
- **Google Protobuf**: 3.9.0
- **Lombok**: ç®€åŒ–æ ·æ¿ä»£ç ã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„
```text
src/main/java/com/eric/netty/
â”œâ”€â”€ NettyApplication.java          # åº”ç”¨ç¨‹åºå…¥å£
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ AuthHandler.java           # å®‰å…¨æ¡æ‰‹å¤„ç†å™¨
â”‚   â”œâ”€â”€ ClientHandlerInitializer.java # æµæ°´çº¿ï¼ˆPipelineï¼‰åˆå§‹åŒ–
â”‚   â”œâ”€â”€ FileTransferUtil.java      # æ–‡ä»¶è½¬ ByteString å·¥å…·ç±»
â”‚   â”œâ”€â”€ HeartbeatHandler.java      # å¿ƒè·³åŠé‡è¿é€»è¾‘
â”‚   â”œâ”€â”€ NettyClient.java           # å®¢æˆ·ç«¯å¯åŠ¨å¼•å¯¼
â”‚   â””â”€â”€ NettyClientHandler.java    # ä¸šåŠ¡é€»è¾‘å¤„ç†
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ ConsumerController.java    # ç”¨äºæ‰‹åŠ¨æµ‹è¯•çš„ HTTP æ¥å£
â””â”€â”€ protocol/
    â””â”€â”€ protobuf/                  # åè®®å®šä¹‰åŠç”Ÿæˆçš„ç±»æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶
- JDK 1.8+
- Maven 3.x
- è¿è¡Œä¸­çš„ Netty æœåŠ¡ç«¯ï¼ˆé»˜è®¤åœ°å€ `127.0.0.1:9999`ï¼‰

### å®‰è£…ä¸è¿è¡Œ
1. **å…‹éš†é¡¹ç›®**
2. **ä½¿ç”¨ Maven æ„å»º**:
   ```bash
   mvn clean install
   ```
3. **è¿è¡Œåº”ç”¨**:
   ```bash
   mvn spring-boot:run
   ```

## ğŸ“– è¯¦ç»†è®¾è®¡

### 1. Netty å®¢æˆ·ç«¯é…ç½®
å®¢æˆ·ç«¯åˆå§‹åŒ–ä¸ºä¸€ä¸ª Spring `@Component`ã€‚å®ƒä½¿ç”¨ `NioEventLoopGroup` å’Œ `NioSocketChannel` è¿›è¡Œéé˜»å¡ I/O æ“ä½œã€‚

### 2. Protobuf é€šä¿¡
é¡¹ç›®ä½¿ç”¨ Google Protocol Buffers è¿›è¡Œç»“æ„åŒ–æ•°æ®åºåˆ—åŒ–ã€‚
- **å®šä¹‰**: æ¶ˆæ¯å®šä¹‰åœ¨ `src/main/java/com/eric/netty/protocol/protobuf/` ä¸‹çš„ `.proto` æ–‡ä»¶ä¸­ã€‚
- **æµæ°´çº¿**:
  - `ProtobufVarint32FrameDecoder`: å¤„ç† TCP æ‹†åŒ…ç²˜åŒ…ã€‚
  - `ProtobufDecoder`: å°†å­—èŠ‚è§£ç ä¸º `MessageBase.Message`ã€‚
  - `ProtobufVarint32LengthFieldPrepender`: ä¸ºä¼ å‡ºæ¶ˆæ¯æ·»åŠ é•¿åº¦å‰ç¼€ã€‚
  - `ProtobufEncoder`: å°† `MessageBase.Message` ç¼–ç ä¸ºå­—èŠ‚ã€‚

### 3. å¿ƒè·³æœºåˆ¶ä¸ç©ºé—²æ£€æµ‹
- **IdleStateHandler**: é…ç½®ä¸ºåœ¨ 10 ç§’æ— æ´»åŠ¨åè§¦å‘ `WRITER_IDLE` äº‹ä»¶ã€‚
- **HeartbeatHandler**: ç›‘å¬ç©ºé—²äº‹ä»¶å¹¶å‘æœåŠ¡ç«¯å‘é€ `PING` å‘½ä»¤ã€‚åŒæ—¶å¤„ç†æœåŠ¡ç«¯çš„ `PONG` å“åº”ã€‚

### 4. é‡è¿ç­–ç•¥
å®¢æˆ·ç«¯å®ç°äº†åŒå±‚é‡è¿æœºåˆ¶ï¼š
- **è¿æ¥å¤±è´¥**: å¦‚æœ `bootstrap.connect()` å¤±è´¥ï¼Œå°†åœ¨ 5 ç§’åè®¡åˆ’é‡è¯•ã€‚
- **è¿æ¥ä¸¢å¤±**: å¦‚æœé€šé“å˜ä¸ºéæ´»è·ƒçŠ¶æ€ (`channelInactive`) æˆ–å‘ç”Ÿå¼‚å¸¸ï¼Œå®¢æˆ·ç«¯å°†å°è¯•é‡æ–°è¿æ¥ã€‚

### 5. èº«ä»½éªŒè¯æ¡æ‰‹
TCP è¿æ¥æˆåŠŸåï¼Œ`AuthHandler` ç«‹å³å‘é€ `AUTH` å‘½ä»¤ã€‚
- å¦‚æœæœåŠ¡ç«¯è¿”å› `AUTH_SUCCESS`ï¼Œåˆ™ä»æµæ°´çº¿ä¸­ç§»é™¤ `AuthHandler`ï¼Œå…è®¸æ­£å¸¸çš„ä¸šåŠ¡æµé‡é€šè¿‡ã€‚
- å¦‚æœæ”¶åˆ° `AUTH_FAIL`ï¼Œåˆ™å…³é—­è¿æ¥ã€‚

## ğŸ§ª æµ‹è¯•è¯´æ˜
æä¾›äº†ä¸€ä¸ª `ConsumerController` ç”¨äºé€šè¿‡ HTTP è§¦å‘æ¶ˆæ¯å‘é€ï¼š
```bash
curl http://localhost:7777/send
```
> **æ³¨æ„**: `/send` æ¥å£ç›®å‰å°è¯•ä»ç¡¬ç¼–ç çš„è·¯å¾„è¯»å–æ–‡ä»¶ã€‚åœ¨è¿è¡Œæ­¤æµ‹è¯•ä¹‹å‰ï¼Œè¯·æ›´æ–° `ConsumerController.java` ä¸­çš„æœ¬åœ°è·¯å¾„ä¸ºæœ‰æ•ˆè·¯å¾„ã€‚

## ğŸ“š å‚è€ƒèµ„æ–™
- [Netty å®˜æ–¹æ–‡æ¡£](https://netty.io/)
- [Protobuf æŒ‡å—](https://developers.google.com/protocol-buffers)
